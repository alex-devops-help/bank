# В этой итерации были настроены деплои для Keycloak и Jenkins, для чего использовались
готовые чарты для cloud-native установки соответствующих операторов и приложений.

Для установки и переустановки (с удалением старого) minikube используется
скрипт ~/project/utils/recreate_minikube.sh без параметров. Необходимо
дождаться его завершения перед запуском остальных скриптов.

После установки minikube необходимо настроить утилиту kubectl для
подключения к API созданного кластера K8s.
Для получения конфига можно использовать команду: minikube kubectl -- config view
и далее настраивать по стандартной инструкции по настройке подключения
kubectl.

Для установки CRD (custom resource definition) и операторов (контроллеров
соответствующих CRD)  используются скрипты ./install.sh.
Cкрипты install.sh не удаляют ранее установленный ими оператор, но создают оператор при его
отсутствии (обычно на новом кластере K8s) и потом запускают скрипт
./recreate.sh, который в свою очередь уже создаёт CR (custom resource)
типа инстанса Keycloak и т.п. из соответствующего YAML определения
(файлы ресурсов .yml)

Причём скрипт ./recreate.sh сначала пытается удалить старый инстанс и только
потом создаёт вместо него новый инстанс.

Скрипты reinstall.sh в отличие от install.sh удаляют и ранее установленный
оператор, например, в случае Jenkins.

Скрипты находятся в соответствующих названиям приложений подкаталогах каталога:
~/project/helm/

Скрипты ./status.sh предназначены для просмотра состояния подов и других
ресурсов.
 
## Подробнее для каждого приложения.


### ~/project/helm/keycloak
install.sh использует так называемый OLM (Operator Lifecycle Manager), 
через который он и устанавливает оператор Keycloak, ресурсы которого для
OLM определены в файле keycloak-operator.yml
В каталог olm скриптом install.sh скачивается и запускается инсталлятор 
OLM-оператора olm/install.sh

Т.е. всего у нас получается два оператора для процедуры полной установки Keycloak:
1) В olm namespace - OLM оператор, роль которого - установка других
операторов, таких как оператор Keycloak.
2) В keycloak namespace - оператор Keycloak, роль которого - установка и запуск
серверов (инстансов) Keycloak.

Сервер Keycloak устанавливается из скрипта recreate.sh в keycloak namespace.
При этом используется определение ресурсов bank-instance.yml
После создания нового инстанса сервера Keycloak, ./recreate.sh запускает
скрипт ~/project/utils/load_json_clients.sh, адаптированный для загрузки
JSON-настроек клиентов Keycloak.

После установки приложение доступно по адресу: http://192.168.49.2/admin/master/console/
Адрес настраивается через Ingress.
User: admin
Password: admin

### ~/project/helm/jenkins
reinstall.sh сначала пытается полностью удалить старый namespace jenkins,
если он существует, далее устанавливает оператор Jenkins из YAML
определений с GitHub, показывает статус установки и запускает скрипт
./recreate.sh, который аналогично предыдущему приложению пересоздаёт инстанс сервера Jenkins 
(с удалением ранее установленного) из определения в файле instance1.yml

После установки приложение доступно по адресу: http://192.168.49.2:30081/manage/
Номер порта настраивается в поле nodePort в файле instance1.yml



# The AUTHOR of this file is Alexander Borisovich Prokopyev (devops@aulix.com), July 2025
